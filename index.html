<!DOCTYPE html>
<html>

<head>
  <title>VRmol - Virtual Reality for Molecule</title>
  <meta charset="utf-8">
  <meta name="description"
    content="VRmol is an easy-to-use web-based tool capable of visualizing and integratively analyzing biomolecular structures in Virtual Reality environment. It connects to multiple resources, such as disease and drug-related databases, enabling it to serve as an integrative platform for structure-based translational researches and drug design.">
  <meta name="keywords"
    content="VRmol, vrmol.net, Molecular Structure Visualization, virtual reality, webvr, cloud-computing, cryo-em, density map, autodock-vina, genomic variation, drug docking">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <link rel="shortcut icon" href="css/vrmol.ico">
  <link rel="stylesheet" href="css/index.css" type="text/css" />
  <link rel="stylesheet" href="css/radial-menu.css" type="text/css" />
  <link rel="stylesheet" href="css/advanced-panel.css" type="text/css" />
  <link rel="stylesheet" href="css/file-dialog.css" type="text/css" />
  <script>
    var _hmt = _hmt || [];
    (function () {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?1962c99900da5c4de135a223484fc0f7";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
  <!--
<script type="text/javascript" src="js/webvr-polyfill/webvr-polyfill.min.js"></script>
<script type="text/javascript" src="js/webvr-ui/webvr-ui.min.js"></script>
-->
  <script type="text/javascript" src="js/libs/three.js"></script>
  <script type="text/javascript" src="js/libs/jquery-1.9.1.min.js"></script>
  <script type="text/javascript" src="js/libs/jquery.simple-color.js"></script>

  <!-- vr -->
  <!-- <script type="text/javascript" src="js/controls/TrackballControls.js"></script>
    <script type="text/javascript" src="js/controls/OrbitControls.js"></script>
    <script type="text/javascript" src="js/controls/VRControls.js"></script>
    <script type="text/javascript" src="js/controllers/VRController.js"></script>
    <script type="text/javascript" src="js/vr/VREffect.js"></script>
    <script type="text/javascript" src="js/vr/WebVR.js"></script> -->
  <script type="text/javascript" src="js/utils/GLTFLoader.js"></script>
  <script type="text/javascript" src="js/libs/inflate.min.js"></script>
  <script type="text/javascript" src="js/utils/FBXLoader.js"></script>
  <script type="text/javascript" src="js/libs/motion-controllers.module.js"></script>
  <script type="text/javascript" src="js/xr/TrackballControls.js"></script>
  <script type="text/javascript" src="js/xr/OrbitControls.js"></script>
  <script type="text/javascript" src="js/controls/FirstPersonControls.js"></script>
  <!--<script type="text/javascript" src="js/xr/ControllerModel.js"></script>-->
  <script type="text/javascript" src="js/xr/XRControllerModelFactory.js"></script>
  <script type="text/javascript" src="js/xr/VRButton.js"></script>
  <!-- Our Design-->

  <!--<script type="text/javascript" src="libs/vrmol.min.js"></script>-->
  <script type="text/javascript" src="libs/w3m.js"></script>
  <script type="text/javascript" src="libs/extension.js"></script>
  <script type="text/javascript" src="libs/static.js"></script>
  <script type="text/javascript" src="libs/math.js"></script>
  <script type="text/javascript" src="libs/core.js"></script>
  <script type="text/javascript" src="libs/loader.js"></script>
  <script type="text/javascript" src="libs/render.js"></script>
  <script type="text/javascript" src="libs/tool.js"></script>
  <script type="text/javascript" src="libs/drawer.js"></script>
  <script type="text/javascript" src="libs/painter.js"></script>
  <script type="text/javascript" src="libs/controller.js"></script>
  <script type="text/javascript" src="libs/pdbparser.js"></script>
  <script type="text/javascript" src="libs/emparser.js"></script>
  <script type="text/javascript" src="libs/surface.js"></script>
  <script type="text/javascript" src="libs/navigation.js?v=6"></script>
  <script type="text/javascript" src="libs/bio-floor-interface.js"></script>
  <script type="text/javascript" src="libs/environment-loader.js?v=edgecolor"></script>
  <script type="text/javascript" src="js/controls/PointerLockControls.js"></script>
  <script type="text/javascript" src="libs/player-controls.js?v=circular"></script>
  <script type="text/javascript" src="libs/focus-mode.js"></script>
  <script type="text/javascript" src="libs/pointer-system.js"></script>
  <script type="text/javascript" src="libs/immersive-menu.js"></script>
  <script type="text/javascript" src="libs/immersive-menu-ext.js"></script>
  <script type="text/javascript" src="libs/canvas-ui.js"></script>
  <script type="text/javascript" src="libs/vr-debug-console.js"></script>
  <script type="text/javascript" src="server/speech/recorder.js"></script>

  <style>
    #immersive-menu-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
      pointer-events: none;
      /* Let clicks pass through to buttons */
    }

    .immersive-center-btn {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.8);
      border: 2px solid rgba(255, 255, 255, 0.2);
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      pointer-events: auto;
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
      text-align: center;
      transition: transform 0.2s;
      z-index: 10;
    }

    .immersive-center-btn:hover {
      transform: scale(1.1);
    }

    .immersive-item-btn {
      position: absolute;
      width: 90px;
      height: 90px;
      border-radius: 24px;
      background: rgba(30, 30, 30, 0.6);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      pointer-events: auto;
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      transition: transform 0.2s, background 0.2s;
    }

    .immersive-item-btn:hover {
      transform: scale(1.1);
      background: rgba(255, 255, 255, 0.15);
    }

    .submenu-indicator {
      position: absolute;
      bottom: 5px;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: white;
      box-shadow: 0 0 5px white;
    }
  </style>

  <!--
    <script type="module">
    import * as THREE from './js/libs/three.module.js';
    // import { OrbitControls } from 'js/xr/OrbitControls.js';
    import { VRButton } from './js/xr/VRButton.js';
    import { XRControllerModelFactory } from './js/xr/XRControllerModelFactory.js';
  </script>
  -->

  <!-- <script type="text/javascript" src="js/vr/statsvr.min.js"></script> 
  <script type="text/javascript" src="js/vr/ViveController.js"></script>
  <script type="text/javascript" src="js/libs/gunzip.min.js"></script>-->
  <script type="text/javascript" src="js/libs/chroma.min.js"></script>
  <script type="text/javascript" src="js/utils/OBJLoader.js"></script>
  <script type="text/javascript" src="js/utils/OBJExporter.js"></script>
  <script type="text/javascript" src="js/utils/SceneUtils.js"></script>
  <!--<script type="text/javascript" src="js/CurveExtras.js"></script>-->
  <!-- Global site tag (gtag.js) - Google Analytics
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135040781-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'UA-135040781-1');
  </script>
  -->
</head>

<body>
  <div id="container"></div>

  <!-- Immersive 3D Radial Menu (Simplified Glassmorphism) -->
  <div id="immersive-menu-container" style="display: none;">
    <!-- Menu content generated by immersive-menu.js -->
  </div>

  <style>
    /* Main Menu Container - Glassmorphism */
    #immersive-menu-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
      pointer-events: none;
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(5px);
    }

    /* Settings Panel */
    #settings-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10001;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: white;
      padding: 10px 15px;
      cursor: pointer;
      font-size: 24px;
      backdrop-filter: blur(5px);
      transition: background 0.2s;
    }

    #settings-toggle:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    #settings-panel {
      position: fixed;
      top: 0;
      right: -320px;
      /* Hidden */
      width: 320px;
      height: 100%;
      background: rgba(15, 20, 25, 0.95);
      backdrop-filter: blur(15px);
      z-index: 10000;
      transition: right 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
      box-shadow: -5px 0 20px rgba(0, 0, 0, 0.5);
      display: flex;
      flex-direction: column;
    }

    #settings-panel.active {
      right: 0;
    }

    .settings-header {
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .settings-header h3 {
      margin: 0;
      color: #00ffff;
      font-size: 1.2rem;
    }

    .close-settings {
      background: none;
      border: none;
      color: rgba(255, 255, 255, 0.6);
      font-size: 24px;
      cursor: pointer;
    }

    .close-settings:hover {
      color: white;
    }

    .settings-content {
      padding: 20px;
      overflow-y: auto;
      flex: 1;
    }

    .settings-section {
      margin-bottom: 30px;
    }

    .shader-section-title {
      font-size: 14px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: rgba(255, 255, 255, 0.5);
      margin-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding-bottom: 5px;
    }

    /* Custom File Upload */
    .custom-file-upload {
      display: inline-block;
      padding: 10px 20px;
      cursor: pointer;
      background: rgba(0, 150, 255, 0.2);
      border: 1px solid rgba(0, 150, 255, 0.5);
      border-radius: 5px;
      color: #00ffff;
      width: 100%;
      text-align: center;
      transition: all 0.2s;
    }

    .custom-file-upload:hover {
      background: rgba(0, 150, 255, 0.4);
    }

    input[type="file"] {
      display: none;
    }

    /* Sliders */
    #settings-panel label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      color: rgba(255, 255, 255, 0.9);
    }

    #settings-panel input[type="range"] {
      width: 100%;
      margin-bottom: 15px;
      background: rgba(255, 255, 255, 0.1);
      height: 4px;
      border-radius: 2px;
      -webkit-appearance: none;
    }

    #settings-panel input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #00ffff;
      cursor: pointer;
      margin-top: -6px;
    }

    #settings-panel input[type="range"]::-webkit-slider-runnable-track {
      width: 100%;
      height: 4px;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 2px;
    }

    #settings-panel span {
      float: right;
      color: #00ffff;
      font-family: monospace;
    }


    /* Center Button (Back/Menu) */
    .immersive-center-btn {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.8);
      border: 2px solid rgba(255, 255, 255, 0.2);
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      pointer-events: auto;
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
      text-align: center;
      transition: all 0.3s ease;
      z-index: 10;
      position: absolute;
    }

    .immersive-center-btn:hover {
      transform: scale(1.1);
      background: rgba(20, 20, 20, 0.9);
      border-color: rgba(255, 255, 255, 0.4);
      box-shadow: 0 0 40px rgba(255, 255, 255, 0.2);
    }

    /* Radial Menu Items */
    .immersive-item-btn {
      width: 90px;
      height: 90px;
      border-radius: 24px;
      background: rgba(30, 30, 30, 0.6);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      pointer-events: auto;
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      gap: 4px;
      position: absolute;
      transition: all 0.2s ease;
      font-size: 0.75rem;
      font-weight: 500;
      text-align: center;
    }

    .immersive-item-btn:hover {
      transform: scale(1.1);
      background: rgba(255, 255, 255, 0.15);
      box-shadow: 0 8px 32px 0 rgba(255, 255, 255, 0.2);
    }

    .immersive-item-btn .icon {
      font-size: 2rem;
    }

    /* Submenu Indicator Dot */
    .submenu-indicator {
      position: absolute;
      bottom: 8px;
      right: 8px;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: white;
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
    }
  </style>


  <div id="info" class="panel">
    <img src="imgs/logo.png" style="width: 100px;">
    <div id="small_menu" class="small_menu">
      <svg class="mdi-icon icon-inline" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
        <path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"></path>
      </svg>
    </div>
  </div>
  <div id="searchDiv" class="panel">
    <input type="text" name="search_text" class="search_text" id="search_text" placeholder="PDB ID"
      onkeydown="PDB.controller.onKeyDown(event)" />
    <input type="button" class="top_btn" id="search_button" value="Search">
    <!-- Upload button moved to Settings Panel -->
    <a class="input-file input-fileup">
      <button class="test" onmousedown="startRecording()" onmouseup="endRecord()">Voice</button>
    </a>
    <a class="messages"></a>
  </div>

  <!-- File Upload Dialog -->
  <div id="file-upload-dialog" class="file-dialog">
    <div class="file-dialog-content">
      <div class="file-dialog-header">
        <h3>üìÅ Load Protein Structure</h3>
        <button class="close-btn" onclick="window.ImmersiveMenuExt.closeFileDialog()">√ó</button>
      </div>

      <!-- Drag & Drop Zone (Hidden for VR compatibility) -->
      <div id="drop-zone" class="drop-zone" style="display: none;">
        <div class="drop-zone-content">
          <div class="drop-icon">üì§</div>
          <p class="drop-text">Drop PDB file here</p>
          <p class="drop-subtext">or click to browse</p>
          <input type="file" id="file-drop-input" accept=".pdb" style="display:none;">
        </div>
      </div>

      <!-- URL Input (Hidden for VR compatibility) -->
      <div class="file-input-section" style="display: none;">
        <label>Load from URL:</label>
        <div class="input-group">
          <input type="text" id="pdb-url-input" placeholder="https://example.com/protein.pdb">
          <button onclick="window.ImmersiveMenuExt.handleURLUpload()">Load</button>
        </div>
      </div>

      <!-- PDB ID Input -->
      <div class="file-input-section">
        <label>Load from PDB ID:</label>
        <div class="input-group">
          <input type="text" id="pdb-id-input" placeholder="1CBS" maxlength="4">
          <button onclick="window.ImmersiveMenuExt.handlePDBIDUpload()">Load</button>
        </div>
      </div>

      <!-- Recent Files -->
      <div class="recent-files-section">
        <label>Recent Files:</label>
        <div id="recent-files-list" class="recent-files-list">
          <div style="color: #888; font-style: italic;">No recent files</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Hidden file input for compatibility -->
  <input type="file" id="radial-upload-input" accept=".pdb" style="display:none;">

  <!-- Advanced Controls Panel (MM key to toggle) -->
  <div id="advanced-controls-panel" class="advanced-panel">
    <div class="advanced-panel-header">
      <h3>‚öôÔ∏è Advanced Controls</h3>
      <button class="close-btn" onclick="window.ImmersiveMenuExt.closeAdvancedPanel()">√ó</button>
    </div>
    <div class="advanced-panel-content">
      <div id="topmenu" class="panel">

        <!--
    <div >
    <a href="https://vrmol.net/?id=https://vrmol.net/data/2019-nCoV-RBD-ACE2-sse.pdb" style="padding: 0px;">* 2019-nCoV-RBD-ACE2<BR />(by Tsinghua U.)</a><BR/>
    <a href="https://vrmol.net/?id=https://vrmol.net/data/2019nCoV-S_RBD_ACE2-sse.pdb" style="padding: 0px;">* 2019-nCoV-RBD-ACE2<BR />(by NMDC)</a><BR/>
    <a href="https://vrmol.net/?id=https://vrmol.net/data/RBD-ACE2-B0AT1-sse.pdb" style="padding: 0px;">*
      RBD-ACE2-B0AT1<BR />(by WestLake U.)</a><BR /><BR/>
    </div>
    -->



        <LABEL onclick="switchMenu('structureMode')">Vis Mode</LABEL><BR />
        <span class="submenu" id="structureMode">
          <button id="threeMode">Non-VR</button><BR />
          <!--<button id="threeWithTravel">Desktop Travel</button><BR /> -->
          <button id="vrMode2">VR</button><BR />
          <!-- <button id="vrWithTravel">VR Travel</button><BR /> -->
          <button id="toggleNavigation">Toggle WASD Controls</button><BR />
          <input id="isLow" name="" type="checkbox" title="isLow" checked />
          <label class="label" for="isLow"> Spherical View </label><BR />
          <!--<input id="threeMode" name="modeStr" checked="checked"   type="radio" title="Three Mode"/>  <label class="label" for="threeMode"> Three </label>   <BR/>-->
          <!--<input id="vrMode"  name="modeStr"  type="radio" title="VR Mode"/>   <label class="label" for="vrMode"> VR </label>    <BR/>-->
          <!--<input id="threeWithTravel" name="modeStr" type="radio" title="Travel in the Tube"/><label class="label" for="threeWithTravel"> Travel + Three </label> <BR/>-->
          <!--<input id="vrWithTravel" name="modeStr" type="radio" title="Travel in the Tube at the mode of VR"/><label class="label" for="vrWithTravel"> Travel + VR</label> <BR/>-->
        </span>
        <BR />

        <LABEL onclick="switchMenu('mainStructure')">Main Structure</LABEL><BR />
        <span class="submenu" id="mainStructure">
          <button id="b_hide">Hide</button><BR />
          <button id="b_line">Line</button><BR />
          <button id="b_dot">Dot</button><BR />
          <button id="b_backbone">Backbone</button><BR />
          <button id="b_a">Sphere</button><BR />
          <button id="b_b">Stick</button><BR />
          <button id="b_ab">Ball & Rod</button><BR />
          <button id="b_tube">Tube</button><BR />
          <button id="b_flat">Ribbon-flat</button><BR />
          <button id="b_ellipse">Ribbon-ellipse</button><BR />
          <button id="b_rectangle">Ribbon-rectangle</button><BR />
          <button id="b_strip">Ribbon-strip</button><BR />
          <button id="b_railway">Ribbon-railway</button><BR />
          <button id="b_sse">Ribbon-SS</button><BR />
          <!--<button id="b_surface">Surface</button><BR/>-->
        </span>
        <BR />

        <LABEL onclick="switchMenu('ligandStructure')">Ligand </LABEL><BR />
        <span class="submenu" id="ligandStructure">
          <button id="h_hide">Hide</button><BR />
          <button id="h_line">Line</button><BR />
          <button id="h_sphere">Sphere</button><BR />
          <button id="h_stick">Stick</button><BR />
          <button id="h_ballrod">Ball & Rod</button><BR />
        </span>
        <BR />
        <LABEL onclick="switchMenu('showOthers')">Show Others</LABEL><BR />
        <span class="submenu" id="showOthers">
          <input name="mode" id="showWater" type="checkbox" title="Show Water" /> <label class="label" for="showWater">
            Show
            Water</label> <BR />
          <input name="mode" id="showAxis" type="checkbox" title="Show Axis" /> <label class="label" for="showAxis">
            Show
            Axis</label> <BR />
        </span>
        <BR />

        <LABEL onclick="switchMenu('surfaceStructure')">Surface</LABEL><BR />
        <span class="submenu" id="surfaceStructure">
          <input id="surfaceN" name="surfaceType" type="radio" title="nothing" /> <label class="label" for="surfaceN">
            Hide
          </label> <BR />
          <input id="surfaceVDW" name="surfaceType" type="radio" title="Van der Waals surface" /> <label class="label"
            for="surfaceVDW">Van der Waals</label> <BR />
          <input id="surfaceSE" name="surfaceType" type="radio" title="solvent excluded surface" /> <label class="label"
            for="surfaceSE">Solvent excluded</label> <BR />
          <input id="surfaceSA" name="surfaceType" type="radio" title="solvent accessible surface" /> <label
            class="label" for="surfaceSA">Solvent accessible</label> <BR />
          <input id="surfaceM" name="surfaceType" type="radio" title="molecular surface" /> <label class="label"
            for="surfaceM">Molecular</label> <BR />
          <hr class="line">
          <input id="surfaceOpacity1" name="surfaceOpacity" type="radio" title="opacity 1.0" /> <label class="label"
            for="surfaceOpacity1">1.0</label> <BR />
          <input id="surfaceOpacity2" name="surfaceOpacity" type="radio" title="opacity 0.9" /> <label class="label"
            for="surfaceOpacity2">0.9</label> <BR />
          <input id="surfaceOpacity3" name="surfaceOpacity" type="radio" title="opacity 0.8" /> <label class="label"
            for="surfaceOpacity3">0.8</label> <BR />
          <input id="surfaceOpacity4" name="surfaceOpacity" type="radio" title="opacity 0.7" /> <label class="label"
            for="surfaceOpacity4">0.7</label><BR />
          <input id="surfaceOpacity5" name="surfaceOpacity" type="radio" title="opacity 0.6" /> <label class="label"
            for="surfaceOpacity5">0.6</label> <BR />
          <input id="surfaceOpacity6" name="surfaceOpacity" type="radio" title="opacity 0.5" /> <label class="label"
            for="surfaceOpacity6">0.5</label><BR />
          <hr class="line">
          <input id="wireFrame" name="surfaceWireframe" type="checkbox" title="Wireframe" /> <label class="label"
            for="wireFrame"> Wireframe </label> <BR />
        </span>
        <BR />

        <LABEL onclick="switchMenu('selectionMode')">Label</LABEL><BR />
        <span class="submenu" id="selectionMode">
          <input name="mode" id="selModel" type="radio" checked="checked" title="All the models" /> <label class="label"
            for="selModel"> All the models</label> <BR />
          <!--<input name="mode" id="selMainHet"    type="radio" title="Main and Het"/>   <label class="label" for="selMainHet"> Main and Het</label>    <BR/>-->
          <!--<input name="mode" id="selMain" type="radio" title="Only Main"/><label class="label" for="selMain"> Only Main </label> <BR/>
        <input name="mode" id="selHet"   type="radio" title="Only Het"/>  <label class="label" for="selHet"> Only Het </label>   <BR/>-->
          <input name="mode" id="selChain" type="radio" title="By Chain" /> <label class="label" for="selChain"> By
            Chain</label> <BR />
          <input name="mode" id="selResidue" type="radio" title="By Residue" /> <label class="label" for="selResidue">
            By
            Residue </label> <BR />
          <input name="mode" id="selAtom" type="radio" title="By Atom" /> <label class="label" for="selAtom"> By Atom
          </label> <BR />
        </span>
        <BR />

        <LABEL onclick="switchMenu('updateColorMode')">Color</LABEL><BR />
        <span class="submenu" id="updateColorMode">
          <input class="updateColor" name="colorMode" id="updatecolor_ByElement" type="radio" title=" By Element"
            color_mode="601" /> <label class="label" for="updatecolor_ByElement"> By Element </label> <BR />
          <input class="updateColor" name="colorMode" id="updatecolor_ByResidue" type="radio" title="By Residue"
            color_mode="602" /> <label class="label" for="updatecolor_ByResidue">By Residue </label> <BR />
          <input class="updateColor" name="colorMode" id="updatecolor_BySecondaryStructure" type="radio"
            title="By Residue" color_mode="603" /> <label class="label" for="updatecolor_BySecondaryStructure">By
            Secondary Structure</label>
          <BR />
          <input class="updateColor" name="colorMode" id="updatecolor_ByChain" type="radio" title="By Residue"
            color_mode="604" /> <label class="label" for="updatecolor_ByChain">By Chain </label> <BR />
          <input class="updateColor" name="colorMode" id="updatecolor_ByRepresentation" type="radio" title="By Residue"
            color_mode="605" /> <label class="label" for="updatecolor_ByRepresentation">By Representation </label>
          <BR />
          <input class="updateColor" name="colorMode" id="updatecolor_ByB_Factor" type="radio" title="By Residue"
            color_mode="606" /> <label class="label" for="updatecolor_ByB_Factor">By B-Factor</label> <BR />
          <input class="updateColor" name="colorMode" id="updatecolor_BySpectrum" type="radio" title="By Residue"
            color_mode="607" /> <label class="label" for="updatecolor_BySpectrum">By Spectrum</label> <BR />
          <input class="updateColor" name="colorMode" id="updatecolor_ByChainSpectrum" type="radio" checked="checked"
            title="By Residue" color_mode="608" /> <label class="label" for="updatecolor_ByChainSpectrum">By Chain
            Spectrum</label> <BR />
          <input class="updateColor" name="colorMode" id="updatecolor_ByHydrophobicity" type="radio" title="By Residue"
            color_mode="609" /> <label class="label" for="updatecolor_ByHydrophobicity">By Hydrophobicity</label> <BR />
          <input class="updateColor" name="colorMode" id="b_load_conser" type="radio" title="By Residue"
            color_mode="610" />
          <label class="label" for="b_load_conser">By Conservation</label> <BR />
          <!--<button name="b_load_conser" id="b_load_conser" value="Export">Load Conservation Score</button>-->
        </span>
        <BR />
        <LABEL onclick="switchMenu('trigger')">Measure</LABEL><BR />
        <span class="submenu" id="trigger">
          <input name="trigger" id="triggerDistance" type="radio" title="Distance" /> <label class="label"
            for="triggerDistance"> Distance </label> <BR />
          <input name="trigger" id="triggerAngle" type="radio" title="Angle" /> <label class="label" for="triggerAngle">
            Angle </label> <BR />
          <input name="trigger" id="isHide" type="checkbox" title="Hide&Show" /> <label class="label" for="isHide"> Hide
          </label> <BR />
        </span>
        <BR />
        <LABEL onclick="switchMenu('dragMode')">Drag</LABEL><BR />
        <span class="submenu" id="dragMode">
          <!--<input name="mode" id="dragModel" checked="checked"  type="radio" title="All the models" />  <label class="label" for="dragModel"> All the models</label>   <BR/>
    <input name="mode" id="dragMainHet"    type="radio" title="Main and Het"/>   <label class="label" for="dragMainHet"> Main and Het</label>    <BR/>
    <input name="mode" id="dragMain" type="radio" title="Only Main"/><label class="label" for="dragMain"> Only Main </label> <BR/>-->
          <input name="mode" id="dragReset" type="radio" title="Reset" /> <label class="label" for="dragReset"> Reset
          </label> <BR />
          <input name="mode" id="dragHet" type="radio" title="Drag Ligand" /> <label class="label" for="dragHet"> Drag
            Ligand </label> <BR />
          <input name="mode" id="dragChain" type="radio" title="Drag Chain" /> <label class="label" for="dragChain">
            Drag
            Chain</label> <BR />
        </span>
        <BR />
        <LABEL onclick="switchMenu('getSegments')">Fragment</LABEL><BR />
        <span class="submenu" id="getSegments">
          <button name="" id="b_show_segmenpanel" value="">Region</button>
        </span>
        <BR />
        <LABEL onclick="switchMenu('getEditing')">Editing</LABEL><BR />
        <span class="submenu" id="getEditing">
          <button name="" id="b_show_editResidue" value="">Editing</button>
        </span>
        <BR />
        <LABEL onclick="switchMenu('mutationMenu')">Mutation</LABEL><BR />
        <span class="submenu" id="mutationMenu">
          <button name="mutationNone" id="mutationNone" value="ExAC">Hide</button><BR />
          <button name="mutationTCGA" id="mutationTCGA" value="TCGA">TCGA</button><BR />
          <button name="mutationCCLE" id="mutationCCLE" value="CCLE">CCLE</button><BR />
          <button name="mutationExAC" id="mutationExAC" value="ExAC">ExAC</button><BR />
          <button name="dbSNP" id="dbSNP" value="dbSNP">dbSNP</button><BR />
          <!--<button name="hideTable" id="hideTable" value="dbSNP">dbSNP</button><BR/>-->
          <input name="showMutationTable" id="showMutationTable" type="checkbox" title="Hide Mutation Table" checked />
          <label class="label" for="showMutationTable">Show Mutation Table</label><BR />
        </span>
        <BR />
        <LABEL onclick="switchMenu('rotationMenu')">Rotation</LABEL><BR />
        <span class="submenu" id="rotationMenu">
          <button name="rotationSwitch" id="rotationSwitch" value="switch">Stop</button><BR />
          <input name="rotateAxis" id="rotateByX" type="radio" title="Rotate By X Axis" value="1" /> <label
            class="label" for="rotateByX">Rotate By X Axis</label> <BR />
          <input name="rotateAxis" id="rotateByY" type="radio" title="Rotate By Y Axis" value="2" /> <label
            class="label" for="rotateByY">Rotate By Y Axis</label> <BR />
          <input name="rotateAxis" id="rotateByZ" type="radio" title="Rotate By Z Axis" value="3" checked /> <label
            class="label" for="rotateByZ">Rotate By Z Axis</label> <BR />
          <button name="rotationLeft" id="rotationClockwise" value="left">Clockwise</button><BR />
          <button name="rotationRight" id="rotationCounterclockwise" value="right">Counterclockwise</button><BR />
        </span>
        <BR />
        <!-- <LABEL onclick="switchMenu('demoMenu')">Demos</LABEL><BR/> -->
        <!-- <span class="submenu" id="demoMenu"> -->
        <!-- <input name="mode" id="showDemo" checked="checked"  type="checkbox" title="Show Demo" />  <label class="label" for="showDemo"> Show Demo</label>   <BR/> -->
        <!-- </span> -->
        <!-- <BR/> -->
        <!--<LABEL onclick="switchMenu('bondMenu')">Bond</LABEL><BR/>
    <span class="submenu" id="bondMenu">
        <button name="hideBond" id="hideBond"  title="Hide Bond">Hide Bond</button>   <BR/>
        <button name="showHBond" id="showHBond"  title="Show HBond">Show HBond</button>   <BR/>
        <button name="showSSBond" id="showSSBond"  title="Show SSBond">Show SSBond</button>   <BR/>
        <button name="showCovalent" id="showCovalent"  title="Show Covalent">Show Covalent</button>   <BR/>
  </span>
    <BR/>-->
        <div style="display:none">
          <LABEL onclick="switchMenu('eCloud')">Density Map</LABEL><BR />
          <span class="submenu" id="eCloud">
            <!-- <label class="label"> Step Option </label><BR/> -->
            <!-- <input id="step1" name="stepOption"  type="radio" title="Map Type"/>  <label class="label" for="threeMode"> 1.x </label> -->
            <!-- <input id="step2" name="stepOption"  checked="checked" type="radio" title="Map Type"/>  <label class="label" for="threeMode"> 2.x </label> -->
            <!-- <input id="step4" name="stepOption"  type="radio" title="Map Type"/>  <label class="label" for="threeMode"> 4.x </label> <BR/> -->
            <button name="loadDensityMap" id="loadDensityMap">Load Density Map</button>
          </span>
          <BR />
        </div>
        <!--<LABEL onclick="switchMenu('conservation')">Conservation</LABEL><BR/>
    <span class="submenu" id="conservation">
      <button name="b_load_conser" id="b_load_conser" value="Export">Load Conservation Score</button>
    </span>
    <BR/>-->
        <LABEL onclick="switchMenu('drugDesign')">Drugs & Docking</LABEL><BR />
        <span class="submenu" id="drugDesign">

          <button name="b_load_drug" id="b_load_drug" value="load drug">Load Drug</button><br />
          <input name="hideDrug" id="hideDrug" type="checkbox" value="hideDrug" />
          <label class="label" for="hideDrug">Hide Drug</label><br />
          <input name="drugSurface" id="drugSurface" type="checkbox" title="Drug drug Surface" />
          <label class="label" for="drugSurface">Drug Surface</label><br />
          <!--<input name="randomMigration" id="randomMigration" type="checkbox" title="Drug Random Migration" />
      <label class="label" for="randomMigration">Drug Random Migration</label><br /> -->
          <input name="showBoxHelper" id="showBoxHelper" type="checkbox" title="Docking Region Box" />
          <label class="label" for="showBoxHelper">Docking Region Box</label><br />
          <button name="b_load_drug" id="hideDrugPanel" value="Hide Drug Panel">Hide Drug Panel</button><br />
        </span>
        <BR />
        <LABEL onclick="switchMenu('exportScene')">Export</LABEL><BR />
        <span class="submenu" id="exportScene">
          <button name="b_export_scene" id="b_export_scene" value="Export">Export</button><br />
          <select id="exportType">
            <option value="MainStructure" selected>MainStructure</option>
            <option value="LigandStructure">LigandStructure</option>
            <option value="Map">Map</option>
          </select><br />
          <button name="b_export_pdb" id="b_export_pdb" value="Export">Export PDB</button>
          <BR />
        </span>
        <!-- <LABEL onclick="switchMenu('chainNumThreshold')">ChainNumThreshold</LABEL><BR/> -->
        <!-- <span class="submenu" id="chainNumThreshold"> -->
        <!-- <button class="labelPDB chainSelected" name="chainName" id="chain_a">a</button>-->
        <!-- </span> -->
        <BR />
        <LABEL onclick="switchMenu('speech')">Speech</LABEL><BR />
        <span class="submenu" id="speech">
          <input name="language" value="English" type="radio" id="English" onclick="getlanguage()" checked="true">
          <label for="English">English</label>
          <br>
          <input name="language" value="Chinese" type="radio" id="Chinese" onclick="getlanguage()">
          <label for="Chinese">Chinese</label>
          <br>
        </span>
        <BR />
        <LABEL onclick="switchMenu('contact')">Help</LABEL><BR />
        <span class="submenu" id="contact">
          <a href="docs" target="_blank">Docs</a>
          <br>
          <a href="https://github.com/kuixu/VRmol" target="_blank">Code</a>
          <br>
          <a href="https://github.com/kuixu/VRmol/issues" target="_blank">Issues</a>
          <br>
          <a href="mailto:xuk16@mails.tsinghua.edu.cn?Subject=VRmol">Email</a>
          <br>
          <a href="http://www.zhanglab.net" target="_blank">ZhangLab</a>
          <br>
        </span>
        <BR />
        <LABEL id="progmsg"></LABEL><BR />
        <LABEL id="tip"></LABEL><br>
        <progress id="progress" value="0"></progress>
        <BR />
      </div>
      <div id="rightmenu">
        <LABEL id="titleLab"></LABEL><BR />
        <span class="rightsubmenu" id="menuSpan">
        </span>
        <BR />
      </div>
      <!--<div id="mutationTable">-->
      <!--<span class="rightsubmenu" id="span">-->
      <!--</span>-->
      <!--</div>-->
      <div id="menu"></div>
      <div id="weChatMask"></div>
      <div id="weChatPop"></div>
      <div id="segmentholder"></div>
      <div id="segmentPanel">
        <div id="segmentHeader">
          <span id="closesegment" class="closerClass">&nbsp;X&nbsp;</span>
        </div>
        <div id="segmentContent">
          <ul>
            <li>Select Region</li>
            <li style="margin-left:30px;list-style: none;">
              <div class="segment_option">
                <input name="selectedStyle" id="chainStyle" type="radio" value=2></input>
                <span style="float:left;line-height: 38px; ">By Chain</span>
                <!--<span style="float:left;color:#333;line-height: 38px; margin-left: 30px;">Chain ID</span>-->
                <select id="chainIDSelect"></select>
              </div>
              <div class="segment_option">
                <input id="fragmentStyle" type="radio" value=1 name="selectedStyle" checked></input>
                <span style="float:left;line-height: 38px; ">By Fragment</span>
                <!--<span style="float:left;color:#333;line-height: 38px; margin-left: 30px;">StartResidue:</span>-->
                <select id="startPoint"></select>
                <!--<span style="float:left;color:#333;line-height: 38px; margin-left: 30px;">EndResidue:</span>-->
                <select id="endPoint"></select>
              </div>
              <div class="segment_option">
                <input name="selectedStyle" id="sseType" type="radio" value=3></input>
                <span style="float:left;line-height: 38px;">By sseType</span>
                <!--<span style="float:left;color:#333;line-height: 38px; margin-left: 30px;">SSE TYPE:</span>-->
                <select id="sseTypeSelect">
                  <option value=150>HELIX</option>
                  <option value=151>SHEET</option>
                  <option value=152>LOOP</option>
                </select>
              </div>
              <div class="segment_option">
                <input name="selectedStyle" id="residueType" type="radio" value=4></input>
                <span style="float:left;line-height: 38px;">By residueType</span>
                <!--<span style="float:left;color:#333;line-height: 38px; margin-left: 30px;">Residue TYPE:</span>-->
                <select id="residueTypeSelect"> </select>
              </div>
            </li>
            <br />
            <li>Representation</li>
            <li style="margin-left:30px;list-style: none;">
              <div class="segment_option">
                <span style="float:left;color:#333;line-height: 38px; margin-left: 30px;">Representation:</span>
                <select id="selectedMode">
                  <option value=3>Backbone</option>
                  <option value=1>Line</option>
                  <option value=2>Dot</option>
                  <option value=6>Ball & Rod</option>
                  <option value=5>Stick</option>
                  <option value=4>Sphere</option>
                  <option value=7>Tube</option>
                  <option value=8>Ribbon-flat</option>
                  <option value=9>Ribbon-ellipse</option>
                  <option value=10>Ribbon-rectangle</option>
                  <option value=11>Ribbon-strip</option>
                  <option value=12>Ribbon-railway</option>
                  <option value=13>Ribbon-SS</option>
                  <option value=14>Surface</option>
                </select>
              </div>
            </li>
            <br />
            <li>Fragment List</li>
          </ul>
          <div id="seletedPanel">
            <!--<span class="fragment" attr=""><span class="fragmentdel">X</span>&nbsp;</span>-->
          </div>
          <button id="addSelected">Add Selected</button>
          <button id="Confirm_fregment">Confirm</button>
        </div>
      </div>
      <div id="editResidue">
        <div id="editResidueHeader">
          <span id="closeeditResidue" class="closerClass">&nbsp;X&nbsp;</span>
        </div>
        <div id="editResidueContent">
          <div style="">
            <span>Selecting Residue</span>
          </div>
          <ul>
            <li>
              <span style="float: left;">Selecting Chain ID:</span>
              <select id="chain_replace"></select>
            </li>
            <li>
              <span style="float: left;">Selecting Residue ID:</span>
              <select id="residue_replace"></select>
            </li>
            <li>
              <span style="float: left;">Target Residue:</span>
              <select id="allResidue"></select>
            </li>
            <li>
              <span style="float: left;">Representation:</span>
              <select id="representation">
                <option value=1>LINE</option>
                <option value=6>BALL_AND_ROD</option>
                <option value=5>STICKS</option>
                <option value=4>SPHERE</option>
              </select>
            </li>
            <li>
              <button id="b_replace">Replace</button>
            </li>
          </ul>
        </div>
      </div> <!-- /topmenu -->
    </div> <!-- /advanced-panel-content -->
  </div> <!-- /advanced-controls-panel -->
  <script type="text/javascript" src="libs/index.js?v=controls"></script>
  <div id="labelContent_measure" style="position:absolute;bottom:30px;right:10px;color:#fff"> </div>
  <div id="labelContent" style="position:absolute;bottom:10px;right:10px;color:#fff"> </div>

  <!-- Environment Model Controls -->
  <div id="envControls"
    style="position:absolute;top:10px;right:10px;background:rgba(0,0,0,0.8);padding:15px;border-radius:8px;color:#fff;font-family:Arial,sans-serif;font-size:12px;min-width:250px;max-height:90vh;overflow-y:auto;display:none;">
    <h3 style="margin:0 0 10px 0;font-size:14px;border-bottom:1px solid #444;padding-bottom:5px;">Environment
      Controls
    </h3>

    <div style="margin-bottom:15px;">
      <h4 style="margin:5px 0;font-size:13px;color:#4CAF50;">Scale</h4>
      <label style="display:block;margin:5px 0;">
        X: <span id="scaleXValue">1.00</span>
        <input type="range" id="scaleX" min="0.01" max="5" step="0.01" value="1" style="width:100%;">
      </label>
      <label style="display:block;margin:5px 0;">
        Y: <span id="scaleYValue">1.00</span>
        <input type="range" id="scaleY" min="0.01" max="5" step="0.01" value="1" style="width:100%;">
      </label>
      <label style="display:block;margin:5px 0;">
        Z: <span id="scaleZValue">1.00</span>
        <input type="range" id="scaleZ" min="0.01" max="5" step="0.01" value="1" style="width:100%;">
      </label>
    </div>

    <div style="margin-bottom:15px;">
      <h4 style="margin:5px 0;font-size:13px;color:#2196F3;">Position</h4>
      <label style="display:block;margin:5px 0;">
        X: <span id="posXValue">0.00</span>
        <input type="range" id="posX" min="-100" max="100" step="0.1" value="0" style="width:100%;">
      </label>
      <label style="display:block;margin:5px 0;">
        Y: <span id="posYValue">0.00</span>
        <input type="range" id="posY" min="-100" max="100" step="0.1" value="0" style="width:100%;">
      </label>
      <label style="display:block;margin:5px 0;">
        Z: <span id="posZValue">0.00</span>
        <input type="range" id="posZ" min="-100" max="100" step="0.1" value="0" style="width:100%;">
      </label>
    </div>

    <button id="resetEnv"
      style="width:100%;padding:8px;background:#f44336;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:12px;">Reset
      to Default</button>
    <button id="toggleEnvControls"
      style="width:100%;padding:8px;background:#607D8B;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:12px;margin-top:5px;">Hide
      Controls</button>
  </div>

  <!-- Settings Toggle -->
  <button id="settings-toggle" onclick="toggleSettings()">‚ò∞</button>

  <!-- Settings Panel -->
  <div id="settings-panel">
    <div class="settings-header">
      <h3>Settings</h3>
      <button class="close-settings" onclick="toggleSettings()">√ó</button>
    </div>

    <div class="settings-content">
      <!-- Upload Section -->
      <div class="settings-section">
        <div class="shader-section-title">File Upload</div>
        <label class="custom-file-upload">
          <input type="file" name="file" id="upload_button">
          üìÅ Upload PDB
        </label>
      </div>

      <!-- Player Controls -->
      <div id="player-controls" class="settings-section">
        <div class="shader-section-title">Player Controls</div>
        <label for="speed-slider">Movement Speed: <span id="speed-value">77.0x</span></label>
        <input type="range" id="speed-slider" min="0.1" max="100.0" step="0.1" value="77.0">

        <label for="height-slider">Player Height: <span id="height-value">10.0m</span></label>
        <input type="range" id="height-slider" min="0.1" max="100.0" step="0.1" value="10.0">
      </div>

      <!-- Shader Controls -->
      <div id="shader-controls" class="settings-section">
        <div class="shader-section-title">Platform Shader</div>

        <label for="time-of-day">Time of Day: <span id="time-of-day-value">Twilight</span></label>
        <input type="range" id="time-of-day" min="0.0" max="1.0" step="0.01" value="0.35">

        <label for="ring-spacing">Ring Spacing: <span id="ring-spacing-value">21.0m</span></label>
        <input type="range" id="ring-spacing" min="2.0" max="50.0" step="1.0" value="21.0">

        <label for="pulse-speed">Pulse Speed: <span id="pulse-speed-value">0.3x</span></label>
        <input type="range" id="pulse-speed" min="0.0" max="10.0" step="0.1" value="0.3">

        <label for="pulse-intensity">Pulse Intensity: <span id="pulse-intensity-value">0.3x</span></label>
        <input type="range" id="pulse-intensity" min="0.0" max="5.0" step="0.1" value="0.3">

        <label for="breathe-speed">Breathe Speed: <span id="breathe-speed-value">0.3x</span></label>
        <input type="range" id="breathe-speed" min="0.0" max="3.0" step="0.1" value="0.3">

        <label for="scanner-toggle" style="display: flex; align-items: center; cursor: pointer; margin-top: 10px;">
          <input type="checkbox" id="scanner-toggle" style="margin-right: 8px; width: auto;">
          Scanner Beam
        </label>
      </div>
    </div>
  </div>

  <script>
    // Player Control Sliders Logic
    document.addEventListener('DOMContentLoaded', function () {
      // Expose PlayerControls globally for focus mode
      window.playerControls = PlayerControls;

      // Speed Slider
      var speedSlider = document.getElementById('speed-slider');
      var speedValue = document.getElementById('speed-value');

      if (speedSlider && speedValue) {
        speedSlider.addEventListener('input', function (e) {
          var val = parseFloat(e.target.value);
          speedValue.textContent = val.toFixed(1) + 'x';
          if (typeof PlayerControls !== 'undefined') {
            PlayerControls.moveSpeedMultiplier = val;
          }
        });
      }

      // Height Slider
      var heightSlider = document.getElementById('height-slider');
      var heightValue = document.getElementById('height-value');

      if (heightSlider && heightValue) {
        heightSlider.addEventListener('input', function (e) {
          var val = parseFloat(e.target.value);
          heightValue.textContent = val.toFixed(1) + 'm';
          if (typeof PlayerControls !== 'undefined') {
            PlayerControls.playerHeight = val;
          }
        });
      }

      // Time of Day Slider
      var timeOfDay = document.getElementById('time-of-day');
      var timeOfDayValue = document.getElementById('time-of-day-value');
      if (timeOfDay && timeOfDayValue) {
        timeOfDay.addEventListener('input', function (e) {
          var val = parseFloat(e.target.value);

          // Update display text
          if (val > 0.75) {
            timeOfDayValue.textContent = 'Day';
          } else if (val > 0.5) {
            timeOfDayValue.textContent = 'Dusk';
          } else if (val > 0.25) {
            timeOfDayValue.textContent = 'Twilight';
          } else {
            timeOfDayValue.textContent = 'Night';
          }

          if (window.environmentUniforms) {
            window.environmentUniforms.uTimeOfDay.value = val;
          }

          // Update lighting
          if (window.ambientLight) {
            window.ambientLight.intensity = 0.2 + (val * 0.6); // 0.2 at night, 0.8 at day
          }
          if (window.sunLight) {
            window.sunLight.intensity = 0.1 + (val * 1.1); // 0.1 at night (moon), 1.2 at day (sun)
            window.sunLight.color.setHex(val > 0.5 ? 0xfff5e6 : 0x8888ff); // Warm day, cool night
          }
          if (window.skyLight) {
            window.skyLight.intensity = val * 0.5; // Fade out at night
          }

          // Update fog color
          if (window.sceneFog) {
            var dayFog = new THREE.Color(0xccddff);
            var nightFog = new THREE.Color(0x001133);
            window.sceneFog.color.copy(nightFog).lerp(dayFog, val);
          }
        });
      }

      // Shader Controls
      var ringSpacing = document.getElementById('ring-spacing');
      var ringSpacingValue = document.getElementById('ring-spacing-value');
      if (ringSpacing && ringSpacingValue) {
        ringSpacing.addEventListener('input', function (e) {
          var val = parseFloat(e.target.value);
          ringSpacingValue.textContent = val.toFixed(1) + 'm';
          if (window.environmentUniforms) {
            window.environmentUniforms.uRingSpacing.value = val;
          }
        });
      }

      var pulseSpeed = document.getElementById('pulse-speed');
      var pulseSpeedValue = document.getElementById('pulse-speed-value');
      if (pulseSpeed && pulseSpeedValue) {
        pulseSpeed.addEventListener('input', function (e) {
          var val = parseFloat(e.target.value);
          pulseSpeedValue.textContent = val.toFixed(1) + 'x';
          if (window.environmentUniforms) {
            window.environmentUniforms.uPulseSpeed.value = val;
          }
        });
      }

      var pulseIntensity = document.getElementById('pulse-intensity');
      var pulseIntensityValue = document.getElementById('pulse-intensity-value');
      if (pulseIntensity && pulseIntensityValue) {
        pulseIntensity.addEventListener('input', function (e) {
          var val = parseFloat(e.target.value);
          pulseIntensityValue.textContent = val.toFixed(1) + 'x';
          if (window.environmentUniforms) {
            window.environmentUniforms.uPulseIntensity.value = val;
          }
        });
      }

      var scannerToggle = document.getElementById('scanner-toggle');
      if (scannerToggle) {
        scannerToggle.addEventListener('change', function (e) {
          if (window.environmentUniforms) {
            window.environmentUniforms.uScannerSpeed.value = e.target.checked ? 0.5 : 0.0;
          }
        });
      }

      var breatheSpeed = document.getElementById('breathe-speed');
      var breatheSpeedValue = document.getElementById('breathe-speed-value');
      if (breatheSpeed && breatheSpeedValue) {
        breatheSpeed.addEventListener('input', function (e) {
          var val = parseFloat(e.target.value);
          breatheSpeedValue.textContent = val.toFixed(1) + 'x';
          if (window.environmentUniforms) {
            window.environmentUniforms.uBreatheSpeed.value = val;
          }
        });
      }
    });
    // Settings Toggle Logic
    function toggleSettings() {
      var panel = document.getElementById('settings-panel');
      panel.classList.toggle('active');
    }
  </script>
</body>

</html>